-- Insert email logs for affected trainees
        INSERT INTO [dbo].[EmailLog] 
        (
            [ToEmail],
            [Subject],
            [Body],
            [IsSent],
            [CreatedDate],
            [SentDate]
        )
        SELECT 
            t.Email AS ToEmail,
            ts.EmailSubject AS Subject,
            REPLACE(ts.EmailBody, N'اسم المتدرب', t.TraineeName) AS Body,
            0 AS IsSent,
            GETDATE() AS CreatedDate,
            NULL AS SentDate
        FROM [dbo].[TraineeInfoPerRequest] req
        INNER JOIN inserted Ins ON req.TrainingPeriodId = Ins.TrainingPeriodId
        INNER JOIN [dbo].[Trainee] t ON req.TraineeId = t.TraineeId
        CROSS JOIN [dbo].[TraineeSettings] ts
        WHERE req.RequestStatusId = 9
        AND t.Email IS NOT NULL
        AND ts.EmailBody IS NOT NULL
